{% extends 'navigation.html' %}
{% load static %}
{% block content %}
 <div class="container">
     <div class="row mb-3">
         <div class="col md-8">
             <h1>Daftar Pengemudi</h1>
         </div>
         <div class="col md-4 text-end">
             <a href="{% url 'pengemudi-create' %}" type="button" class="btn btn-primary">+Tambah Pengemudi</a>
         </div>
     </div>
   <div>
        <table class="table table-striped table-hover" id="masterTable">
            <thead>
                <tr>
                    <td>No</td>
                    <td>Nama</td>
                    <td>Usia</td>
                    <td>Foto</td>
                    <td>Nik</td>
                    <td>Pool</td>
                    <td>Bus</td>
                    <td>Edit?</td>
                    <td>Kartu</td>
                </tr>
            </thead>
            <tbody>
                {% for pengemudi in object_list %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><a href="{% url 'pengemudi-detail' pengemudi.nik %}" style="text-decoration:none" class="link-dark">{{ pengemudi.nama }}</td>
                        <td id="id_tanggal_lahir">{{ pengemudi.usia }}</td>
                        <td><img src="{{ pengemudi.pasfoto.url }}" width="50"></td>
                        <td>{{ pengemudi.nik }}</td>
                        <td>{{ pengemudi.pool }}</td>
                        <td>{{ pengemudi.bus }}</td>
                        <td><a type="button" href="{% url 'pengemudi-update' %}{{ pengemudi.id }}" class="btn btn-secondary">edit</a></td>
                        <td><a type="button" href="{% url 'print-id' %}{{ pengemudi.nik }}" class="btn btn-primary">eCard</a></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<script src="{% static 'js/jquery-3.6.1.min.js' %}"></script>
<script src="{% static 'js/jquery-ui.js' %}"></script>
<script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
<script type="text/javascript">
    $(document).ready( function () {
    $('#masterTable').DataTable( {
        "pageLength": 5
        } );
    } );
</script>
<script>
    let lahir = new Date(document.getElementById('id_tanggal_lahir').innerHTML);
    let today = new Date();
    let year = 0;
    let usia = 0;
    console.log(today);
    //document.getElementById('id_tanggal_lahir').onchange = function() {fillUsia()};
    function fillUsia(){
        lahir = new Date(document.getElementById('id_tanggal_lahir').innerHTML);
        //usia = (today.getDay() - lahir.getDay()) /  (1000 * 60 * 60 * 24); ;
        if (today.getMonth() < lahir.getMonth()) {
            year = 1;
        } else if ((today.getMonth() == lahir.getMonth()) && today.getDate() < lahir.getDate()) {
            year = 1;
        }
        usia = today.getFullYear() - lahir.getFullYear() - year;
        const bulan = today.getMonth() - lahir.getMonth();
        const hari = today.getDate() - lahir.getDate();
        const monthDiff = (bulan < 0 ? 12 + bulan : bulan);
        const dayDiff = (hari < 0 ? new Date(today.getFullYear(), today.getMonth() - 1, 0).getDate() + hari : hari);
        console.log(today.getFullYear())
        console.log(lahir.getFullYear())
        document.getElementById('id_tanggal_lahir').innerHTML = "Usia: " + usia + " Tahun, " + monthDiff + " Bulan, " + dayDiff + " Hari";
    }
</script>
{% endblock %}